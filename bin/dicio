#!/usr/bin/env node

const request = require('request-promise')
const cheerio = require('cheerio')
const removeAccents = require('desacentuador')
const printer = require('../src/printer')
const htmlParser = require('../src/htmlParser')

const [,, word] = process.argv

if (!word) {
  console.log('Uso: dicio <palavra>')
  process.exit(0)
}

request({
  uri: `https://www.dicio.com.br/${removeAccents(word)}/`,
  encoding: 'latin1',
  transform: (body) => {
    return cheerio.load(body)
  }
}).then(($) => {
  printer(htmlParser($))
}).catch(error => {
  if (error.statusCode === 404) {
    console.log('Palavra n√£o encontrada.')
    process.exit(1)
  }

  console.log('Error interno.')
  process.exit(1)
})
